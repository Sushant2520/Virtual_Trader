const axios = require('axios'); const NodeCache = require('node-cache'); const cache = new NodeCache({ stdTTL:5 });
async function getQuote(symbol){ const key='price:'+symbol; const c=cache.get(key); if(c) return c; try{ if(symbol.toUpperCase().endsWith('USDT')){ const r = await axios.get('https://api.binance.com/api/v3/ticker/price?symbol='+symbol.toUpperCase()); const p = parseFloat(r.data.price); cache.set(key,p); return p; } else { const av = process.env.ALPHA_VANTAGE_KEY; if(!av) return null; const url = `https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${symbol}&apikey=${av}`; const r = await axios.get(url); const d = r.data['Global Quote']||{}; const p = parseFloat(d['05. price']) || null; cache.set(key,p); return p; } }catch(e){ console.error('market fetch err', e.message); return null; } }
module.exports = { getQuote };
